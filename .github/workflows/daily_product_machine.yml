name: 100% Super Advance Product Machine

on:
  workflow_dispatch: # рдмрдЯрди рджрдмрд╛рддреЗ рд╣реА рдЪрд▓реЗрдЧрд╛
  schedule:
    - cron: '0 10 * * *' # рд░реЛрдЬрд╝ рд╕реБрдмрд╣ 10 рдмрдЬреЗ рдЕрдкрдиреЗ рдЖрдк

jobs:
  launch_product:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Generate Premium Content (AI Logic)
        run: |
          # рдпрд╣ рд╕реНрдЯреЗрдк рдЦреБрдж рдПрдХ рдЧрд╛рдЗрдб рдлрд╛рдЗрд▓ рдмрдирд╛рдПрдЧрд╛
          echo "рдпрд╣ рдЖрдкрдХреА рдкреНрд░реАрдорд┐рдпрдо рдПрдЖрдИ рдмрд┐рдЬрдиреЗрд╕ рдЧрд╛рдЗрдб рд╣реИред рдЗрд╕рдореЗрдВ 10 рдЧреБрдкреНрдд рддрд░реАрдХреЗ рджрд┐рдП рдЧрдП рд╣реИрдВред" > premium_guide.txt
          echo "рдЖрдЬ рдХреА рддрд╛рд░реАрдЦ: $(date)" >> premium_guide.txt

      - name: Publish to Gumroad and Telegram
        run: |
          # 1. рдирдпрд╛ рдкреНрд░реЛрдбрдХреНрдЯ рдмрдирд╛рдирд╛ (Unique Name рдХреЗ рд╕рд╛рде)
          PRODUCT_NAME="AI_Success_Kit_$(date +'%d_%b')"
          
          RESPONSE=$(curl -s -X POST https://api.gumroad.com/v2/products \
            -d "access_token=${{ secrets.GUMROAD_TOKEN }}" \
            -d "name=$PRODUCT_NAME" \
            -d "price=1000" \
            -d "description=рдпрд╣ рдПрдХ рдСрдЯреЛ-рдЬреЗрдирд░реЗрдЯреЗрдб рдкреНрд░реАрдорд┐рдпрдо рдбрд┐рдЬрд┐рдЯрд▓ рдкреНрд░реЛрдбрдХреНрдЯ рд╣реИред" \
            -d "published=true")
          
          # рдЬрд╡рд╛рдм рд╕реЗ ID рдФрд░ URL рдирд┐рдХрд╛рд▓рдирд╛
          PRODUCT_ID=$(echo $RESPONSE | jq -r '.product.id')
          SHORT_URL=$(echo $RESPONSE | jq -r '.product.short_url')

          # 2. рдкреНрд░реЛрдбрдХреНрдЯ рдХреЗ рд╕рд╛рде рдлрд╛рдЗрд▓ рдЬреЛреЬрдирд╛ (рддрд╛рдХрд┐ рдЦрд░реАрджрд╛рд░ рдХреЛ рд╕рд╛рдорд╛рди рдорд┐рд▓реЗ)
          curl -s -X POST "https://api.gumroad.com/v2/products/$PRODUCT_ID/files" \
            -F "access_token=${{ secrets.GUMROAD_TOKEN }}" \
            -F "file=@premium_guide.txt"

          # 3. рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдкрд░ рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдзрдорд╛рдХрд╛
          if [[ "$PRODUCT_ID" != "null" ]]; then
            MSG="ЁЯЪА *рдирдпрд╛ рдкреНрд░реАрдорд┐рдпрдо рдкреНрд░реЛрдбрдХреНрдЯ рд▓рд╛рдЗрд╡!* %0A%0AЁЯУж рдирд╛рдо: $PRODUCT_NAME %0AЁЯФЧ рдЦрд░реАрджрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ: $SHORT_URL %0A%0AтЬЕ рдСрдЯреЛрдореЗрд╢рди рдорд╢реАрди рд╕рдлрд▓ рд░рд╣реАред"
          else
            MSG="тЭМ рдорд╢реАрди рдореЗрдВ рдЧреЬрдмреЬ! рдЧрдорд░реЛрдб рдиреЗ рдХрд╣рд╛: $(echo $RESPONSE | jq -r '.message')"
          fi

          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
          -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
          -d text="$MSG" \
          -d parse_mode="Markdown"
