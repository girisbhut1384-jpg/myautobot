name: Lemon_Squeezy_Victory_Final
on:
  workflow_dispatch:

jobs:
  create_product:
    runs-on: ubuntu-latest
    steps:
      - name: Create Premium Product
        run: |
          # Lemon Squeezy API v1 के लिए एकदम सटीक फॉर्मेट
          # ID: 136979 आपके स्क्रीनशॉट से कन्फर्म की गई है
          RESPONSE=$(curl -s -X POST "https://api.lemonsqueezy.com/v1/products" \
            -H "Accept: application/vnd.api+json" \
            -H "Content-Type: application/vnd.api+json" \
            -H "Authorization: Bearer ${{ secrets.LEMON_SQUEEZY_TOKEN }}" \
            -d '{
              "data": {
                "type": "products",
                "attributes": {
                  "name": "Premium High-Value Product",
                  "description": "Premium Digital Asset worth $49",
                  "price": 4900,
                  "status": "published"
                },
                "relationships": {
                  "store": {
                    "data": {
                      "type": "stores",
                      "id": "136979"
                    }
                  }
                }
              }
            }')

          echo "Response: $RESPONSE"

          # टेलीग्राम पर जीत की खबर
          if [[ $RESPONSE == *"\"type\":\"products\""* ]]; then
             MSG="✅ विजय! Lemon Squeezy ने प्रोडक्ट स्वीकार कर लिया है। अब कमाई शुरू!"
          else
             # अगर कोई एरर आए तो उसका मैसेज निकालें
             ERR_MSG=$(echo $RESPONSE | grep -o '\"detail\":\"[^\"]*\"' | cut -d'\"' -f4 || echo "Unknown Error")
             MSG="❌ रिपोर्ट: $ERR_MSG"
          fi

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d text="$MSG"
