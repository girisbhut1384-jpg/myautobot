name: Final_Success_Machine_Fixed
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Create Product
        run: |
          # ‡§π‡§Æ‡§®‡•á ‡§Ø‡§π‡§æ‡§Å 'Bearer' ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡§æ ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•á ‡§ü‡•ã‡§ï‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§π‡•à
          RESPONSE=$(curl -s -X POST "https://api.gumroad.com/v2/products" \
            -H "Authorization: Bearer ${{ secrets.GUMROAD_TOKEN }}" \
            -d "name=Automatic_Success_$(date +%H%M)" \
            -d "price=1000" \
            -d "description=Official Automated Product" \
            -d "published=true")

          echo "Response: $RESPONSE"

          # ‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§™‡§∞ ‡§∏‡•Ä‡§ß‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂
          if [[ $RESPONSE == *"\"success\":true"* ]]; then
             MSG="‚úÖ ‡§ú‡•Ä‡§§ ‡§ó‡§è! ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü Gumroad ‡§™‡§∞ ‡§¨‡§® ‡§ö‡•Å‡§ï‡§æ ‡§π‡•à‡•§"
          else
             # ‡§Ö‡§ó‡§∞ 404 ‡§Ü‡§è ‡§§‡•ã ‡§Ø‡§π ‡§∏‡§æ‡•û ‡§¨‡§§‡§æ‡§è‡§ó‡§æ
             MSG="üìä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü: $(echo $RESPONSE | head -c 50)"
          fi

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d text="$MSG"
