name: Ultimate_Final_Fix
on:
  workflow_dispatch:

jobs:
  run_machine:
    runs-on: ubuntu-latest
    steps:
      - name: Command to Gumroad
        run: |
          # ध्यान दें: हमने URL के आखिर में 'products' के बाद कुछ नहीं लगाया है
          # और टोकन को Header में डाल दिया है
          RESPONSE=$(curl -s -X POST "https://api.gumroad.com/v2/products" \
            -H "Authorization: Bearer ${{ secrets.GUMROAD_TOKEN }}" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "name=Final_Success_Product_$(date +%H%M)" \
            -d "price=1000" \
            -d "description=Master Guide" \
            -d "published=true")
          
          echo "Response: $RESPONSE"
          
          # टेलीग्राम पर मैसेज भेजना (बिना कचरे के)
          if [[ $RESPONSE == *"success\":true"* ]]; then
            MSG="✅ जीत गए! प्रोडक्ट लाइव है।"
          else
            # अगर 404 आए तो यह साफ़ बताएगा
            MSG="❌ गमरोड ने फिर मना किया। जवाब का छोटा हिस्सा: $(echo $RESPONSE | head -c 50)"
          fi

          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
          -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
          -d text="$MSG"
