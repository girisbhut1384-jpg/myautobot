name: Lemon_Squeezy_Deep_Debug
on:
  workflow_dispatch:

jobs:
  create_product:
    runs-on: ubuntu-latest
    steps:
      - name: Create Product with Full Report
        run: |
          # हम इस बार पूरा रिस्पॉन्स कैप्चर करेंगे
          RESPONSE=$(curl -s -i -X POST "https://api.lemonsqueezy.com/v1/products" \
            -H "Accept: application/vnd.api+json" \
            -H "Content-Type: application/vnd.api+json" \
            -H "Authorization: Bearer ${{ secrets.LEMON_SQUEEZY_TOKEN }}" \
            -d '{
              "data": {
                "type": "products",
                "attributes": {
                  "name": "Premium Asset",
                  "description": "High Value Product",
                  "price": 4900,
                  "status": "published"
                },
                "relationships": {
                  "store": {
                    "data": {
                      "type": "stores",
                      "id": "136979"
                    }
                  }
                }
              }
            }')

          # रिस्पॉन्स की पहली 200 लाइनें टेलीग्राम के लिए साफ़ करना
          REPORT=$(echo "$RESPONSE" | tail -n 5)
          
          if [[ "$RESPONSE" == *"201 Created"* ]]; then
             MSG="✅ सफलता! प्रोडक्ट बन गया है।"
          else
             MSG="⚠️ सर्वर की रिपोर्ट: $REPORT"
          fi

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d text="$MSG"
